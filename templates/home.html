<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Fluxo de Investidores B3</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0f172a] text-white">
<header class="bg-gradient-to-r from-sky-900 to-indigo-900 p-6 text-center shadow-lg">
    <h1 class="text-3xl font-bold drop-shadow-xl">Fluxo de Investidores B3</h1>
    <p class="text-sm mt-1 text-slate-300">Acompanhe o movimento de capital no mercado</p>
</header>

<main class="max-w-7xl mx-auto px-4 py-10 space-y-10">
    
    <form method="POST" class="flex flex-wrap justify-center gap-4 mb-6">
        <input type="date" name="data_inicio" class="bg-slate-800 p-2 rounded text-white" required>
        <input type="date" name="data_fim" class="bg-slate-800 p-2 rounded text-white" required>

        <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white font-semibold py-3 px-6 rounded-xl shadow-md transition">
            ðŸ”„ Atualizar GrÃ¡fico
        </button>
    </form>

    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
        {% for key, label, cor, desc in [
            ('estrangeiro_acum', 'Estrangeiro', 'blue-400', 'fundos e investidores de fora do Brasil'),
            ('institucional_acum', 'Institucional', 'orange-400', 'fundos de pensÃ£o, seguradoras, etc.'),
            ('pessoafisica_acum', 'Pessoa FÃ­sica', 'green-400', 'investidores individuais'),
            ('instfinanceira_acum', 'Inst. Financeira', 'pink-400', 'bancos e corretoras'),
            ('outros_acum', 'Outros', 'purple-400', 'empresas, governo e nÃ£o categorizados')
        ] %}
        {% set valor = resumo[key] if resumo and key in resumo else 0 %}
        <div class="bg-[#1e293b] p-4 rounded-xl shadow-xl border-l-4 border-{{ cor }} transition">
            <h3 class="text-{{ cor }} font-bold text-md mb-1">{{ label }}</h3>
            <p class="text-xl font-semibold text-white drop-shadow">R$ {{ "%.1f"|format(valor|float)|replace('.', ',') }}Bi</p>
            <p class="text-xs text-gray-400 italic mb-1">{{ desc }}</p>
            <p class="text-sm {{ 'text-green-400' if valor > 0 else 'text-red-400' }}">
                {{ 'Entrada lÃ­quida' if valor > 0 else 'SaÃ­da lÃ­quida' }}
            </p>
        </div>
        {% endfor %}
    </section>

    {% if imagem %}
    <div class="bg-[#1e293b] p-6 rounded-xl shadow-lg">
        <img src="data:image/png;base64,{{ imagem }}" alt="GrÃ¡fico de Fluxo de Investidores" class="w-full rounded">
    </div>
    {% endif %}

    <footer class="text-center text-sm text-slate-400 border-t border-slate-700 pt-6 mt-6">
        <p><strong>Fonte:</strong> B3 e Dados de Mercado â€¢ Ãšltimo dado de fluxo: {{ last_date if last_date else '-' }}</p>
        <p><a href="https://www.instagram.com/alan_richard" class="text-blue-400 hover:underline" target="_blank">@alan_richard</a> â€“ Dashboard Fluxo de Investidores â€¢ Valores em bilhÃµes de reais</p>
    </footer>

    <section class="bg-slate-800 p-4 rounded-xl shadow space-y-3 mt-10">
        <h2 class="text-lg font-bold text-white">Resumo MÃªs a MÃªs</h2>
        {% for mes, info in resumo_mensal.items() %}
        <div class="text-sm text-slate-300">
            <strong>{{ mes }}</strong>: Maior entrada - {{ info.maior_entrada }}, Maior saÃ­da - {{ info.maior_saida }}
        </div>
        {% endfor %}
    </section>
    </main>

</body>
</html>